# 历史记录功能使用指南

## 🎉 新功能介绍

现在您可以在页面右侧看到一个**历史记录面板**，它会自动保存您所有上传过的音频文件！

## ✨ 主要功能

### 1. 自动保存历史
- 每次上传和处理音频文件后，系统会自动保存
- 保存内容包括：
  - 📝 完整转录文本
  - 📋 智能总结
  - 🔖 文件名和上传时间
  - 💬 可恢复的对话会话

### 2. 查看历史记录
- 右侧面板显示所有历史记录
- 最新的记录在最上面
- 每条记录显示：
  - 文件名
  - 上传时间
  - 转录预览（前100字符）

### 3. 切换会话
- 点击任意历史记录即可切换到该会话
- 自动加载该音频的转录和总结
- 对话功能自动恢复，可以继续提问

## 📖 使用步骤

### 第一次使用

1. **启动服务器**
   ```bash
   python run_app.py
   ```

2. **打开前端**
   ```bash
   # 新终端
   python -m http.server 8080
   ```

3. **访问页面**
   - 浏览器打开：`http://localhost:8080`
   - 此时右侧显示"暂无历史记录"

### 上传第一个音频

1. **选择音频文件**
   - 拖拽文件到上传区域，或
   - 点击上传区域选择文件

2. **等待处理**
   - 转录进度实时显示
   - 总结内容流式生成
   - 看到"处理完成"消息

3. **查看结果**
   - 左侧显示转录文本和总结
   - 右侧历史记录自动新增一条
   - 对话功能自动激活

4. **进行对话**
   - 在下方对话框输入问题
   - 例如："这段音频的主要内容是什么？"
   - AI基于转录内容回答

### 使用历史记录

1. **查看历史列表**
   - 右侧面板显示所有历史记录
   - 当前激活的会话会高亮显示（蓝紫色边框）

2. **切换到历史会话**
   - 点击任意历史记录
   - 系统自动加载：
     - ✅ 转录文本
     - ✅ 总结内容
     - ✅ 对话会话（自动恢复）

3. **在历史会话中对话**
   - 会话恢复后，对话区域激活
   - 可以基于该历史音频继续提问
   - 支持多轮对话

## 🎯 使用场景

### 场景1：对比多个音频

```
1. 上传音频A → 查看转录和总结
2. 上传音频B → 查看转录和总结
3. 点击历史记录中的音频A → 快速切换回去
4. 在两个音频之间自由切换
```

### 场景2：长期保存

```
今天上传的音频，明天依然可以：
- 查看转录内容
- 查看总结内容
- 继续对话提问
```

### 场景3：批量处理

```
1. 连续上传多个音频文件
2. 所有文件都保存在历史记录中
3. 随时切换查看任意一个
4. 每个都可以独立对话
```

## 💡 界面说明

### 主界面布局

```
┌─────────────────────────────────────────────┬──────────────┐
│                  标题                        │              │
├─────────────────────────────────────────────┤              │
│            上传区域                          │              │
├─────────────────────────────────────────────┤   历史记录   │
│  转录文本  │  智能总结                       │              │
├─────────────────────────────────────────────┤   面板      │
│            对话区域                          │              │
│                                              │              │
└─────────────────────────────────────────────┴──────────────┘
```

### 历史记录项样式

```
┌──────────────────────────────┐
│ 📄 audio.mp3                 │  ← 文件名
│ ⏰ 01/15 14:30               │  ← 上传时间
│ 这是转录内容的预览，显示前...  │  ← 预览
└──────────────────────────────┘
```

- **正常状态**：白色背景，灰色边框
- **悬停状态**：蓝紫色边框，略微向左移动
- **激活状态**：蓝紫色渐变背景，蓝紫色边框

## 🔧 高级功能

### 会话恢复

如果会话已过期（1小时未使用）：

1. 点击历史记录
2. 看到提示："会话已过期，正在重新初始化..."
3. 系统自动重新创建会话：
   - 加载转录文本
   - 创建向量索引
   - 恢复对话功能
4. 约1-2秒后，对话功能可用

### 数据持久化

- 历史记录保存在：`audio_history/history.json`
- 服务器重启后依然保留
- 不会丢失任何历史数据

### 性能优化

- 历史列表只加载预览（100字符）
- 完整内容按需加载（点击时）
- 向量存储按需创建（首次对话时）

## 📊 示例操作流程

### 完整示例

```
步骤1: 上传第一个音频 meeting.mp3
  ↓
转录: "今天的会议讨论了项目进度..."
总结: "会议主要内容包括..."
  ↓
右侧出现: 📄 meeting.mp3 (01/15 14:30)

步骤2: 提问 "会议的结论是什么？"
  ↓
AI回答基于转录内容

步骤3: 上传第二个音频 interview.mp3
  ↓
转录和总结显示
  ↓
右侧出现: 
  📄 interview.mp3 (01/15 14:35) ← 最新
  📄 meeting.mp3 (01/15 14:30)

步骤4: 点击 meeting.mp3
  ↓
切换回第一个音频的会话
  ↓
可以继续对话："还有其他要点吗？"
```

## ❓ 常见问题

### Q: 历史记录会保存多久？
A: 永久保存，除非手动删除 `audio_history/history.json` 文件。

### Q: 可以删除历史记录吗？
A: 当前版本不支持从界面删除，可以手动编辑 `audio_history/history.json`。未来版本会添加删除功能。

### Q: 历史记录会占用很多空间吗？
A: 只保存文本内容（转录和总结），不保存音频文件本身，占用空间很小。

### Q: 切换会话时对话记录会保留吗？
A: 对话记录保存在内存中，切换会话时会清空当前对话。历史对话暂不保存（未来可能添加）。

### Q: 可以在多个设备上查看历史记录吗？
A: 历史记录保存在服务器本地，只要连接到同一服务器，任何设备都可以查看。

### Q: 会话恢复需要多长时间？
A: 通常1-2秒，取决于转录文本长度和网络速度（需要调用OpenAI API创建向量索引）。

## 🎨 界面提示

### 状态指示

- **"暂无历史记录"** - 还没有上传任何音频
- **"正在加载..."** - 正在从服务器获取历史数据
- **"加载历史记录失败"** - 网络错误或服务器问题
- **"会话已过期，正在重新初始化..."** - 会话恢复中

### 视觉反馈

1. **历史记录项**
   - 悬停：边框变蓝紫色，略微向左移
   - 激活：渐变背景，明显高亮

2. **加载状态**
   - 转录和总结区域显示"正在加载..."
   - 加载完成后内容替换

3. **对话区域**
   - 会话切换时自动清空
   - 恢复完成后显示"对话功能已就绪"

## 🚀 快捷操作

### 键盘快捷键

- `Enter` - 在对话输入框中按Enter发送消息
- 未来可能添加更多快捷键

### 鼠标操作

- 点击历史记录项 - 切换会话
- 拖拽文件到上传区 - 上传新音频
- 滚动历史面板 - 查看更多历史记录

## 📈 性能建议

1. **建议每次上传单个文件**
   - 避免同时处理多个文件
   - 等待当前文件处理完成再上传下一个

2. **定期清理历史**
   - 如果历史记录过多（>100条）
   - 可能影响加载速度
   - 建议定期备份和清理

3. **保持网络连接**
   - 切换会话时可能需要调用API
   - 确保网络稳定

## 🎓 最佳实践

1. **有意义的文件名**
   - 使用描述性的文件名
   - 便于在历史记录中快速识别

2. **及时测试对话**
   - 上传后立即测试对话功能
   - 确保会话创建成功

3. **保存重要对话**
   - 重要的对话可以复制保存
   - 当前版本不自动保存对话历史

4. **定期备份**
   - 定期备份 `audio_history/history.json`
   - 防止意外数据丢失

## 🎉 开始使用

现在就开始使用历史记录功能吧！

1. ✅ 启动服务器：`python run_app.py`
2. ✅ 打开浏览器：`http://localhost:8080`
3. ✅ 上传音频文件
4. ✅ 查看右侧历史记录
5. ✅ 点击切换，开始体验！

享受更便捷的音频处理和对话体验！ 🚀

